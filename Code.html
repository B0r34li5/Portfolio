<!doctype html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <title>B0r34li5 Portfolio ðŸ’…</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="IndexStyle.css">
        <link rel = "icon" href="Files/IconSpud.png">
    </head>
    <body>
        <div class = topbar>
            <div class = "item" style = "width: 19%; vertical-align: center; line-height: 100px; text-align: center;">
                <p style = "font-size: xx-large; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;">
                [B0r34li5]
                </p>
            </div>
            
            <div class = "item d-grid gap-1 col-6 row-3" style = "width: 19%;">
                <a href = "index.html" type="button" class="btn btn-light btn-block h-75" >
                    <span style="font-size: xx-large; position: relative; top: 5px">
                        Start
                    </span>
                </a>
            </div>

            <div class = "item d-grid gap-1 col-6 row-3" style = "width: 19%;">
                <a href = "Projects.html" type="button" class="btn btn-light btn-block h-75" >
                    <span style="font-size: xx-large; position: relative; top: 5px">
                        Projects
                    </span>
                </a>
            </div>
            
            <div class = "item d-grid gap-1 col-6 row-3" style = "width: 19%;">
                <a href = "Code.html" type="button" class="btn btn-warning btn-block h-75" >
                    <span style="font-size: xx-large; position: relative; top: 5px">
                        Code
                    </span>
                </a>
            </div>

            <div class = "item d-grid gap-1 col-6 row-3" style = "width: 19%;">
                <a href = "OffPlatform.html" type="button" class="btn btn-light btn-block h-75" >
                    <span style="font-size: x-large; position: relative; top: 12px">
                        Off-Platform
                    </span>
                </a>
            </div>

        </div>

        <div height = "1000px" style="height: 6000px; position: relative; top: 100px;">
            <br>
            <h1 align = center style="font-family: Trebuchet MS;">
                <b>Code Snippets</b>
                <center><hr width="10%"></center>
                
            </h1>
            <center>
                <div style="width: 75%; height: 400px;">
                    <div class="card" style="width: 600px;">
                    <img src="Files/BuildingSystem.gif" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">Realtime Building System</h5>
                        <p class="card-text">A building system designed to be used in real time with unanchored components, it is very flexicble and versatile, having support for extra potential block types and sizes in the future.</p>
                    </div>
                    </div>
                </div>

            <div class = "snippet" style="width: 90%; height: fit-content; text-align: left; position: relative; top: 120px;">
                <pre>
--{{Services}}
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CollectionService = game:GetService("CollectionService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local Player = Players.LocalPlayer
--{{Modules}}
local ReplicatedModules = ReplicatedStorage:WaitForChild("Modules")
local KnitRepo = ReplicatedModules:WaitForChild("KnitRepo")

local Knit = require(KnitRepo:WaitForChild("Knit"))

local PlayerController = Knit.CreateController {
	Name = "PlayerController"
}

local BLOCK_UNIT_SIZE = 4
local valid_position = false
local rparams = RaycastParams.new()
rparams.FilterType = Enum.RaycastFilterType.Exclude

function stepify(x , step)
	return math.round(x / step) * step
end

function vec3math(vec, call , ...) --
	return Vector3.new(call(vec.X , ...),call(vec.Y , ...),call(vec.Z , ...))
end

function weld(from : BasePart , to : BasePart)
	local weld = Instance.new("WeldConstraint")
	from.Anchored = false
	weld.Parent = from
	weld.Part0 = from
	weld.Part1 = to
	weld.Enabled = true
end

function snap(to_snap , callback)
	local new = nil 
	to_snap = if callback then vec3math(to_snap , callback) else to_snap
	new = vec3math(to_snap , stepify , BLOCK_UNIT_SIZE)
	return new
end

function omni_snap(to_snap : Vector3 , normal : Vector3 , block_size : Vector3 , target) --Gets a position that is snapped to grid, in object space.
	normal = vec3math(normal , math.round)
	local perpendicular_axes = (Vector3.new(1,1,1) -Vector3.new(math.abs(normal.X),math.abs(normal.Y),math.abs(normal.Z)) )
	local perpendicular_pos = snap(to_snap , math.round)
	local parallel_pos =  snap(vec3math(to_snap , math.abs) * normal , math.round)
	perpendicular_pos *= perpendicular_axes
	
	return perpendicular_pos + parallel_pos
end

function PlayerController:KnitStart()
	local ConstructionService = Knit.GetService("ConstructionService")
	local block = game.ReplicatedStorage.Block:Clone()
	local block_frame_value = Instance.new("CFrameValue")
	local block_target_frame = CFrame.new()
	local block_target_point = nil
	local block_target_instance
	block.Parent = workspace
	block.CanCollide = false
	block.CanQuery = false
	block.CanTouch = false
	rparams.FilterDescendantsInstances = {block}
	
	local function update_block()
		local mouse = Player:GetMouse()
		local raycast = workspace:Raycast(mouse.UnitRay.Origin , mouse.UnitRay.Direction * 60 , rparams)
		
		if raycast then
			local position_delta = raycast.Instance:GetPivot():PointToObjectSpace(raycast.Position)
			local position_snapped = omni_snap(position_delta , raycast.Instance:GetPivot():VectorToObjectSpace(raycast.Normal) , Vector3.one * BLOCK_UNIT_SIZE , raycast.Instance)
			block_target_instance = nil
			block_target_point = nil
			if CollectionService:HasTag(raycast.Instance , "BuildingBlock") then
				block_target_frame = raycast.Instance:GetPivot().Rotation + raycast.Instance:GetPivot():PointToWorldSpace(position_snapped)
				block_target_instance = raycast.Instance
				block_target_point = position_snapped
			else
				block_target_frame = block:GetPivot().Rotation + raycast.Position
			end
			TweenService:Create(block_frame_value , TweenInfo.new(0.075) , {Value = block_target_frame}):Play()
		end
	end
	
	block_frame_value.Changed:Connect(function(value: CFrame)  
		block:PivotTo(value)
	end)
	
	UIS.InputBegan:Connect(function(input: InputObject, gameProcessedEvent: boolean)  
		if not gameProcessedEvent then
			if input.UserInputType == Enum.UserInputType.MouseButton1 and block_target_instance then
				local new = block:Clone()
				new.Parent = workspace
				new:PivotTo(block_target_frame)
				weld(new , block_target_instance)
				ConstructionService:CreateBlock(CFrame.new() + block_target_point , block_target_instance , "default")
				new.Color = Color3.new()	
				new.Size *= 1.01
				new:Destroy()
			end
		end
	end)
	while task.wait() do
		update_block()
	end
end





return PlayerController
                    </pre>
                </div>

                <div style="width: 75%; height: 400px; position: relative; top: 200px;">
                    <div class="card" style="width: 600px;">
                    <img src="Files/CardSystem.gif" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">OOP Card System</h5>
                        <p class="card-text">Card games are some of the most complex to program. In order to achieve an easily maintable codebase that I can add to frequently I relied heavily on Object Oriented Programming to group and reuse behaviors and minimize boilerplate code, here is an example of a class for one of the card types. </p>
                    </div>
                    </div>
                </div>

                <div class = "snippet" style="width: 90%; height: fit-content; text-align: left; position: relative; top: 250px;">
                <pre>
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local KnitRepo = ReplicatedStorage.Modules.Knit
local Knit = require(KnitRepo.Knit)
local Trove = require(KnitRepo.Trove)
local ActionSequence = require(KnitRepo.ActionSequence)
local BaseTower = {}

BaseTower.__index = BaseTower

function BaseTower.new()
	local self = setmetatable({} , BaseTower)
	self.Type = "tower"
	self.DisplayName = ""
	self.Description = ""
	self.Image = ""
	self.Rarity = 1
	self.Number = 0

	self.Cost = 2
	self.Count = 1

	self.Damage = 20
	self.MaxAmmo = 1
	self.ReloadTime = 1
	self.MaxReloadTime = 1
	self.MaxPerks = 1
	self.BulletType = game.ReplicatedStorage.Assets.Projectiles.blueLaser

	self.TargetTag = "CubeModel"
	self.TargetsAll = false
	self.TargetsOwn = false

	self.DealsSplashDamage = false
	self.Inert = false

	self._trove = Trove.new()

	return self
end

function BaseTower:Create(player)
	local CardModels = ReplicatedStorage.Assets.CardModels.Towers
	local new = setmetatable({} , BaseTower)

	for k , v in self do
		new[k] = v
	end

	new.Owner = player
	new.Model = (CardModels:FindFirstChild(self.Name) or CardModels:FindFirstChild("SampleBlast")):Clone()
	new.Ammo = self.MaxAmmo
	new._trove = Trove.new()
	new.Perks = {}
	new.OnTick = ActionSequence.new()

	new.Model.Name= self.Name

	new.Model:SetAttribute("TargetsAll" , self.TargetsAll)
	new.Model:SetAttribute("TargetsOwn" , self.TargetsOwn)
	new.Model:SetAttribute("Ammo" , new.Ammo)
	new.Model:SetAttribute("MaxAmmo" , self.MaxAmmo)
	new.Model:SetAttribute("ReloadTime" , 0)
	new.Model:SetAttribute("Damage" , self.Damage)
	new.Model:SetAttribute("Inert" , self.Inert)
	new:Init()

	return new
end

function BaseTower:Init() -- in here create non primitive values specific to each instance

end

function BaseTower:HasName(name)
	return self.Name == name
end

function BaseTower:Recharge()
	self.Ammo = self.MaxAmmo
	self.ReloadTime = 0
	self.Model:SetAttribute("Ammo" , self.Ammo)
	self.Model:SetAttribute("ReloadTime" , self.ReloadTime)
	self.ReloadTime = self.MaxReloadTime
end

function BaseTower:ChangeAmmo(amount)
	self.Ammo = math.clamp(self.Ammo + amount , 0 , self.MaxAmmo)
	self.Model:SetAttribute("MaxAmmo" , self.MaxAmmo)
	self.Model:SetAttribute("Ammo" , self.Ammo)
	
	if self.Ammo == 0 then
		self.ReloadTime = self.MaxReloadTime
		self.Model:SetAttribute("ReloadTime" , self.ReloadTime)
	end
end

function BaseTower:ChangeMaxAmmo(amount)
	self.MaxAmmo += amount
	self.Ammo = math.min(self.Ammo + amount , self.MaxAmmo)
	self.Model:SetAttribute("MaxAmmo" , self.MaxAmmo)
	self.Model:SetAttribute("Ammo" , self.Ammo)
end

function BaseTower:ChangeDamage(amount)
	self.Damage = math.max(self.Damage + amount , 0)
	self.Model:SetAttribute("Damage" , self.Damage)
end

function BaseTower:CanPlace(previous_tower)
	return true
end

function BaseTower:Destroy()
	local BoardService = Knit.GetService("BoardService")
	for _ , perk in self.Perks do
		perk:Unequip(self)
	end
	self.Model:Destroy()
	
	BoardService:RemoveTower(self)

end

function BaseTower:CanEquipPerk(perk)
	if #self.Perks < self.MaxPerks then
		return true
	end

	return false
end

function BaseTower:EquipPerk(perk)
	table.insert(self.Perks , perk)
end

function BaseTower:Tick()
	if self.Ammo < self.MaxAmmo then
		self.ReloadTime -=1
		self.Model:SetAttribute("ReloadTime" , self.ReloadTime)
		if self.ReloadTime <= 0 then
			self:Recharge()
		end
	end

	self.OnTick:Fire()
end

function BaseTower:Attack(cube)
	self:FireProjectile(cube)
	cube:Damage(self)
end

function BaseTower:AttemptAttack(cube)
	local MapService = Knit.GetService("MapService")
	if self.Ammo < 1 then print("Insufficient ammo") return end
	self:ChangeAmmo(-1)
	self.Model:SetAttribute("Ammo" , self.Ammo)
	self.Model:SetAttribute("ReloadTime" , self.ReloadTime)
	if self.DealsSplashDamage then
		return self:AttackDelayGroup(cube.Owner , cube.Delay)
	else
		self:Attack(cube)
		return {cube}
	end
	
end

function BaseTower:AttackDelayGroup(player , delay)
	local BoardService = Knit.GetService("BoardService")
	local cubes = BoardService:GetFrozenCubeList(player)
	local targets = {}
	local hit = 0
	for _ , splash_cube in cubes do
		if splash_cube.Delay == delay then
			table.insert(targets , splash_cube)
			task.spawn(function()
				
				self:FireProjectile(splash_cube)
				splash_cube:Damage(self)
				hit += 1
			end)
		end
	end
	
	repeat task.wait() until hit == #targets
	print(targets)
	return targets
end

function BaseTower:FireProjectile(cube)
	local bullet = self.BulletType:Clone()
	bullet.Parent = self.Model
	self.Model.target:PivotTo(CFrame.lookAt(self.Model.target:GetPivot().Position , cube.Model.Position))
	bullet:PivotTo(self.Model.target.barrel:GetPivot())
	local t = TweenService:Create(
		bullet,
		TweenInfo.new(0.3 , Enum.EasingStyle.Linear),
		{Position = cube.Model.Position}
	)

	t:Play()
	t.Completed:Wait()
	bullet:Destroy()
end

return BaseTower
                </pre>
                </div>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <h6>It is worth noting that this site has been programmed by me in html/css.</h5>
                <br>

            </center>
        </div>
        <br>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    </body>
</html>
